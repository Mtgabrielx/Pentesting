import socket
import os

class shell_():
    def __init__(self):
        self.white_list = ['dir','echo','pwd']
        self.socket_ = socket.socket(socket.AF_INET,socket.SOCK_STREAM)
        self.socket_.bind(("localhost",4444))
        self.socket_.listen(1)
    
    def escutar(self):
        client, addr = self.socket_.accept()
        while client:
            recv = client.recv(2048)
            resultado,saida = self.verificar(recv.decode())
            if resultado:
                try:
                    client.send(saida.encode())
                except:pass
            else:
                client.send(f"Comando invalido, os comando válidos são {self.white_list}".encode())
        self.socket_.close()

    def verificar(self,comando):
        if comando.split()[0] in self.white_list:
            os.system(f'{comando} > saida.txt')
            with open("saida.txt") as file:
                resultado = file.read()
            print(f"{resultado}")
            return True,resultado
        return False

conexao = shell_()
conexao.escutar()