import socket
import sys
import requests
import re

#teste = http://www.bancocn.com/

class Socket: 
    def __init__(self,url,seguir_pesquisar):
        self.urls = [url]
        self.padrao_http = r'^https?://\S+$'
        self.links_padrao = 'href=[\'"](https?://[^\'" >]+)'
        self.padrao_www = r'^(https?://)(www\.)'
        self.pesquisar(url,seguir_pesquisar)
        if len(self.urls) == 1:
            print("Nenhuma url do domínio foi encontrada")
        else:
            for i in self.urls:
                print(i)
        
    def pesquisar(self,url,seguir_pesquisar=False,cont=1):
        match = re.match(r'^https?://(?:www\.)?([^./]+)',url)
        SubString = match.group(1) if match else None

        if not re.match(self.padrao_http,url):
            print("Formato da url está incorreto")
        else:
            resposta = requests.get(url)
            if resposta.status_code  == 200:
                novas_urls = ([i for i in re.findall(self.links_padrao,resposta.text) if re.sub(self.padrao_www,r'\1',i) not in self.urls])
                self.urls.extend([i for i in novas_urls if SubString in i])
            else:
                print("Erro de conexão")
        if seguir_pesquisar and cont < len(self.urls):
            self.pesquisar(self.urls[cont],True,cont+1)

argumentos = sys.argv
socket_scan = Socket(argumentos[1], False)